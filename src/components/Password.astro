---
import "../styles/global.css"
---
<meta charset="utf-8">
<style>
  .pass-overlay{
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    pointer-events: auto;
    transition: opacity .6s ease;
    background: rgba(0,0,0,0.25);
  }

  /* 底部白色大遮罩 */
  .pass-overlay .bottom-mask{
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    height: 150vh; /* 可调 */
    background: #fff;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.15);
    pointer-events: none;
  }

  .pass-box{
    position: relative;
    width: 92%;
    max-width: 480px;
    padding: 22px;
    border-radius: 12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,250,0.95));
    box-shadow: 0 10px 40px rgba(6,24,60,0.35);
    text-align: center;
    z-index: 10000;
    transition: transform .35s cubic-bezier(.2,.9,.2,1);
  }

  .pass-box.shake{
    animation: shake .45s;
  }
  @keyframes shake{
    10%{ transform: translateX(-8px) }
    30%{ transform: translateX(6px) }
    50%{ transform: translateX(-4px) }
    70%{ transform: translateX(3px) }
    100%{ transform: translateX(0) }
  }

  .pass-box h2{
    margin: 0 0 12px 0;
    font-size: 1.2rem;
    color: #1b1b1b;
  }

  .pass-input{
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #e6e6e6;
    box-sizing: border-box;
    font-size: 1rem;
    outline: none;
    transition: box-shadow .15s, border-color .15s;
  }
  .pass-input:focus{
    border-color: #55888c;
    box-shadow: 0 6px 18px rgba(85,136,140,0.12);
  }

  .actions{
    margin-top: 12px;
    display:flex;
    gap:8px;
    justify-content:center;
    align-items:center;
  }
  .btn{
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    background: linear-gradient(180deg,#6fbec0,#4f9da0);
    color: #fff;
  }
  .btn.ghost{
    background: transparent;
    border: 1px solid #ddd;
    color: #333;
    font-weight: 600;
  }

  .hint{
    margin-top: 10px;
    font-size: 0.88rem;
    color: #666;
  }
  .hint a{
    color: #55888c;
    text-decoration: none;
    cursor: pointer;
  }

  .reveal{
    margin-top:8px;
    overflow: hidden;
    max-height: 0;
    transition: max-height .35s ease, opacity .25s ease;
    opacity: 0;
  }
  .reveal.show{
    max-height: 120px;
    opacity: 1;
  }
  .copy-btn{
    margin-top:6px;
    padding:8px 12px;
    border-radius:8px;
    background:#222;
    color:#fff;
    border:none;
    cursor:pointer;
  }

  .small-note{
    display:block;
    margin-top:6px;
    font-size:0.78rem;
    color:#999;
  }

</style>

<div class="pass-overlay" id="passOverlay" role="dialog" aria-modal="true" aria-label="密码输入">
  <div class="bottom-mask" aria-hidden="true"></div>

  <div class="pass-box" id="passBox">
    <h2>请输入密码</h2>

    <input id="passInput" class="pass-input" type="text" placeholder="在此输入..." aria-label="密码输入框" />

    <div class="actions">
      <button id="confirmBtn" class="btn">确定</button>
      <button id="cancelBtn" class="btn ghost">取消</button>
    </div>

    <div class="hint" aria-live="polite">
      <a id="getPass" href="#">点此获取密码</a>

      <div class="reveal" id="revealArea" aria-hidden="true">
        <button id="copyBtn" class="copy-btn">点我复制密码</button>
      </div>
    </div>
  </div>
</div>

<script>
  const overlay = document.getElementById('passOverlay');
  const box = document.getElementById('passBox');
  const input = document.getElementById('passInput');
  const confirmBtn = document.getElementById('confirmBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const getPass = document.getElementById('getPass');
  const revealArea = document.getElementById('revealArea');
  const copyBtn = document.getElementById('copyBtn');

  // 初始聚焦
  setTimeout(()=>input.focus(), 120);

  // 展开获取密码区域
  getPass.addEventListener('click', (e)=>{
    e.preventDefault();
    if(revealArea.classList.contains('show')){
      revealArea.classList.remove('show');
      revealArea.setAttribute('aria-hidden','true');
    } else {
      revealArea.classList.add('show');
      revealArea.setAttribute('aria-hidden','false');
    }
  });

  // 复制密码（这里示例密码为 "密码"）
  copyBtn.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText('密码');
      copyBtn.textContent = '已复制 ✓';
      setTimeout(()=>copyBtn.textContent = '点我复制密码', 2000);
    }catch(e){
      copyBtn.textContent = '复制失败';
      setTimeout(()=>copyBtn.textContent = '点我复制密码', 2000);
    }
  });

  // 取消隐藏组件（只是隐藏示例）
  cancelBtn.addEventListener('click', ()=>{
    window.location.href = "/";
  });

  // 确认逻辑：输入等于 "密码" 时淡出并 display:none
  confirmBtn.addEventListener('click', ()=>{
    const v = input.value.trim();
    if(v === '密码'){
      overlay.style.opacity = '0';
      // 轻微缩放动画
      box.style.transform = 'scale(.98)';
      setTimeout(()=> overlay.style.display = 'none', 650);
    } else {
      // 失败效果：抖动+提示文字
      box.classList.remove('shake');
      // 强制重绘以重触发动画
      void box.offsetWidth;
      box.classList.add('shake');
    }
  });

  // 按回车确认
  input.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') confirmBtn.click();
  });

  // 点击遮罩时不关闭（如果需要可开启）
  overlay.addEventListener('click', (e)=>{
    if(e.target === overlay){
      // 不做任何事，保持遮罩
    }
  });
</script>